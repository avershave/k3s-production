#!/bin/bash -x
# 
# Copyright 2021 Carnegie Mellon University.
# Released under a BSD (SEI)-style license, please see LICENSE.md in the
# project root or contact permission@sei.cmu.edu for full terms.

#############################
#   Crucible Stack Install   #
#############################

# Change to the current directory
cd "$(dirname "${BASH_SOURCE[0]}")"
helm repo add stackstorm https://helm.stackstorm.com/
./setup-gitlab
# # Crucible Stack install
if [[ ${IMPORT_CONTENT-$IMPORT_CONTENT} = false ]]; then 
  helm upgrade --wait --install -f player.values.yaml player ../charts/player 
  helm upgrade --wait --install -f caster.values.yaml caster ../charts/caster
  helm upgrade --wait --install -f steamfitter.values.yaml steamfitter ../charts/steamfitter
  helm upgrade --wait --install -f alloy.values.yaml alloy ../charts/alloy
  helm upgrade --wait --install -f mongodb.values.yaml mongodb bitnami/mongodb
  helm upgrade --wait --install --timeout 10m -f stackstorm-min.values.yaml stackstorm stackstorm/stackstorm-ha
fi

